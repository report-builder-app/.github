# Концепция сервиса создания отчетов

- Основан на open-source библиотеках и инструментах
- Простой ui интерфейс редактора отчетов
- Гибкий и удобный синтаксис описания отчетов (DSL)
- Сервер хранения и управления отчетами для on-premise развертывания


## DSL

```groovy
report("CustomerReport") {
    // Общие параметры отчёта
    title = "Customer List"
    pageFormat = PageFormat.A4
    orientation = PageOrientation.PORTRAIT
    
    // Параметры отчёта
    parameters {
        param("ReportTitle", String, "Customer List")
        param("StartDate", Date)
        param("EndDate", Date)
    }
    
    // Поля (получаемые из запроса или источника данных)
    fields {
        field("customerId", Long)
        field("firstName", String)
        field("lastName", String)
        field("email", String)
        field("totalPurchases", BigDecimal)
    }
    
    // Запрос данных
    queryString("""
        SELECT c.id as customerId, c.first_name as firstName, 
               c.last_name as lastName, c.email, 
               SUM(o.total) as totalPurchases
        FROM customers c
        JOIN orders o ON c.id = o.customer_id
        WHERE o.order_date BETWEEN \$P{StartDate} AND \$P{EndDate}
        GROUP BY c.id, c.first_name, c.last_name, c.email
    """)
    
    // Стили
    styles {
        style("titleStyle") {
            font {
                size = 18
                isBold = true
            }
            horizontalAlignment = Alignment.CENTER
        }
        
        style("columnHeader") {
            font {
                isBold = true
            }
            background = Color.LIGHT_GRAY
        }
    }
    
    // Структура отчёта
    bands {
        titleBand {
            label(text: "\$P{ReportTitle}", style: "titleStyle")
        }
        
        columnHeader {
            label(text: "ID", width: 50)
            label(text: "Name", width: 150)
            label(text: "Email", width: 200)
            label(text: "Total", width: 100)
        }
        
        detail {
            textField(expression: "\$F{customerId}", width: 50)
            textField(expression: "\$F{firstName} + ' ' + \$F{lastName}", width: 150)
            textField(expression: "\$F{email}", width: 200)
            textField(expression: "\$F{totalPurchases}", width: 100)
        }
        
        summary {
            line(y: 0)
            textField(expression: "Total customers: " + "\$V{REPORT_COUNT}")
        }
    }
}
```

## UI

**Редактор отчетов** — инструмент, позволяющий пользователям создавать, редактировать и визуализировать отчёты различных типов. Основные функции, необходимые такому редактору, включают:

1. Создание и редактирование отчётов
- Возможность добавления нового отчета.
- Редактирование существующих отчетов.
- Создание шаблонов отчетов.
2. Форматирование текста и данных
- Форматирование заголовков, основного текста, списков, таблиц.
- Применение стилей (шрифтов, размеров шрифта, цветов).
- Добавление ссылок и гиперссылок.
- Работа с изображениями и мультимедиа-контентом.
3. Работа с источниками данных
- Импорт данных из внешних источников (базы данных, Excel-файлы, API-сервисы).
- Подключение к различным базам данных (SQL, NoSQL, облачные хранилища).
- Автоматическое обновление данных.
4. Инструменты анализа данных
- Фильтрация, сортировка и группировка данных.
- Построение диаграмм и графиков (линейные графики, круговые диаграммы, гистограммы).
- Расчет показателей (сумма, среднее значение, медиана, процент изменения).
5. Настройка структуры документа
- Разделение отчета на секции, главы и подразделы.
- Использование иерархической структуры содержания.
- Динамическое управление элементами страницы (перемещение блоков, изменение размера).
6. Экспорт и публикация отчетов
- Экспорт отчетов в различные форматы (PDF, Word, Excel, HTML).
- Печать документов прямо из интерфейса.
- Облачное хранение отчетов и возможность делиться ими с коллегами.
7. Управление пользователями и правами доступа
- Авторизация пользователей.
- Настройки прав доступа к отчетам и данным.
- История изменений и версионность файлов.
8. Автоматизация и интеграция
- Планировщик заданий для автоматического обновления отчетов.
- Интеграции с внешними сервисами и платформами (CRM, ERP, BI-инструменты).
- Поддержка RESTful API для интеграции с другими системами.


**Ключевые компоненты:**

1. Панель навигации (Navigation Panel)
Панель навигации позволяет быстро перемещаться между различными частями приложения, такими как создание новых отчетов, просмотр старых отчетов, доступ к шаблонам и настройкам профиля.

2. Боковая панель инструментов (Sidebar Tools)
Здесь размещаются инструменты для работы с содержимым отчета: кнопки для вставки изображений, таблицы, диаграммы, текстовых элементов, фильтрации данных и настройки внешнего вида.

3. Основная рабочая область (Main Workspace)
Это центральная зона экрана, где пользователи создают и редактируют контент своего отчета. Она должна поддерживать работу с текстом, таблицами, графиками и мультимедийными объектами.

4. Панель свойств элемента (Element Properties Panel)
Отображается рядом с основным рабочим пространством и показывает свойства выбранного элемента (например, шрифт, размер, выравнивание). Эта панель также позволяет настраивать отображение и поведение каждого компонента отчета индивидуально.

5. Виджет управления данными (Data Management Widget)
Позволяет подключаться к внешним источникам данных, импортировать файлы, обновлять данные вручную или автоматически, выбирать фильтры и агрегировать показатели.

6. Меню экспорта и публикации (Export & Publish Menu)
Обеспечивает экспорт отчета в разные форматы (PDF, Excel, CSV), печать и возможность поделиться ссылкой на отчет.

7. Контекстное меню (Context Menu)
Открывается при клике правой кнопкой мыши на элементе и предлагает быстрые действия над выбранным объектом, такие как копирование, удаление, перемещение вверх/вниз и настройка стиля.

8. Вспомогательные элементы (Helper Elements):
- Tooltip: всплывающие подсказки, объясняющие назначение отдельных компонентов и функций.
- Modal Windows: окна для ввода настроек, выбора параметров и подтверждения действий (например, сохранение файла перед закрытием).
- Notifications: уведомления об успехе операции или ошибках, возникающих при работе с данными.

Эти компоненты формируют удобный и понятный интерфейс, облегчающий взаимодействие пользователя с редактором отчетов и повышающий эффективность работы с ним.
